# ONFRAUD

Autors: Raul del Aguila, Mariano Fernandez Lopez, Mari Carmen Suarez Figueroa `


## Ontologías

There are two files containing the ontologies:
+ `onfraudv8_1rdf` base ontology, without mapping to DBPedia.
+ `onfraudv10_1_rdf_enlazada` the ontology linked to DBPedia.

## Documentation:

The documentation has been generated both with [Ontoology](http://ontoology.linkeddata.es) and with [Protégé](https://protege.stanford.edu/).
We recommend to access the documentation through the index generated by Ontoology. For example:
`.\onfraud_article\OnToology\onfraudv10_1_rdf_enlazada.owl\documentation\index-en-html`
If you would like to review the diagrams generated, go through the folder `.\onfraud_article\OnToology\onfraudv10_1_rdf_enlazada.owl\diagrams` 

## Open Data

The folder `Open Refine` contains the Open Refine project used to transform the data of minor contracts published by [Ayuntamiento de Madrid](http://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=139afaf464830510VgnVCM1000000b205a0aRCRD&vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default)
The RDF skeleton was generated as follows:

![Alineamiento 1](https://github.com/datalavidaloca/onfraud/blob/master/img/esqueleto-1.png?raw=true)

![Alineamiento 2](https://github.com/datalavidaloca/onfraud/blob/master/img/esqueleto-2.png?raw=true)

## OnFraudDashboard: RedFlagInspector
Folder `OnFraudDashboard` contains the web app and RDF.jar needed to execute the app.
To generate the architecture detailed on the paper, you must follow these steps:

### Endpoint configuration



***Docker comtainer configuration*** 

Firstly download this image:

`docker pull tenforce/virtuoso`

And run it:  the container

`docker run --name objective_jones -p 127.0.0.1:8890:8890 -p 127.0.0.1:1111:1111 -e DBA_PASSWORD="ROOT" -e SPARQL_UPDATE=true -e DEFAULT_GRAPH="http://purl.org/puchase2pay/individuals/" -v //DESKTOP-NCTP077/db:/data -d tenforce/virtuoso`

***Check the container is running***

`docker ps`

Supose we called the container `objective_jones`


***Load open data to the container*** 
`docker cp Contratos-Menores2.ttl objective_jones:/usr/local/virtuoso-opensource/var/lib/virtuoso/db/dumps`

***Execute bash***
`docker exec -it <container id> bash`

***Enter to the DDBB console and execute***
`isql-v -U dba -P $DBA_PASSWORD`

***Bind the namespace to the dataset***
`ld_dir('dumps', '*.ttl', 'http://purl.org/purchase2pay/individuals/');`

***Load the dataset***
`rdf_loader_run();`
 
### Update config.properties

This file must be updated with the proper paths. 

IMPORTANT: The path defined in the key `rdf ` is used by the app. In case of being executed in a windows environment, remember to use \\\ instead of /

### Execution
You can both execute this architecture from RStudio or from a shiny server. 
As example, the following images contains the execution of the server:


![General Dashboard](https://github.com/datalavidaloca/onfraud_paper/blob/master/imgs/GeneralDashboard.png?raw=true)


![Approval Limits](https://github.com/datalavidaloca/onfraud_paper/blob/master/img/ApprovalLimits.png?raw=true)


![Aggregation](https://github.com/datalavidaloca/onfraud_paper/blob/master/img/AggregationScheme.png?raw=true)


![Outliers](https://github.com/datalavidaloca/onfraud_paper/blob/master/img/SingleContractsOutliers.png?raw=true)


![Results dashboard](https://github.com/datalavidaloca/onfraud_paper/blob/master/img/ResultsDashboard.png?raw=true)

















